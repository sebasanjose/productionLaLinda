{% extends "base.html" %}

{% block title %}Dashboard - La Linda Tracker{% endblock %}

{% block content %}
<div class="mb-4">
  <h1>Dashboard</h1>
  <p class="text-muted">Overview of current inventory and recent activity.</p>
</div>

<div class="grid grid-cols-2 gap-4 mb-4">
  <!-- Wrapped Inventory Card -->
  <div class="card">
    <h3>ðŸ¥Ÿ Wrapped (Unbaked)</h3>
    {% if wrapped_inventory %}
    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>Flavor</th>
            <th>Dozens</th>
          </tr>
        </thead>
        <tbody>
          {% for flavor, quantity in wrapped_inventory.items() %}
          <tr>
            <td>{{ flavor }}</td>
            <td>{{ "%.1f"|format(quantity) }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <p class="text-muted">No wrapped inventory.</p>
    {% endif %}
  </div>

  <!-- Baked Inventory Card -->
  <div class="card">
    <h3>ðŸ”¥ Fully Baked</h3>
    {% if baked_inventory %}
    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>Flavor</th>
            <th>Available</th>
          </tr>
        </thead>
        <tbody>
          {% for flavor, quantity in baked_inventory.items() %}
          <tr>
            <td>{{ flavor }}</td>
            <td>{{ "%.1f"|format(quantity) }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <p class="text-muted">No baked inventory available.</p>
    {% endif %}
  </div>
</div>

<!-- Recent Events Section -->
<div class="card">
  <div class="flex justify-between items-center mb-4">
    <h3>Recent Market Events</h3>
    <a href="{{ url_for('markets') }}" class="btn btn-secondary">View All</a>
  </div>

  {% if recent_events %}
  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th>Date</th>
          <th>Market</th>
          <th>Sold</th>
          <th>Leftover</th>
          <th>Cash</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for event in recent_events %}
        <tr>
          <td>{{ event['event_date'] }}</td>
          <td>{{ event['market_name'] }}</td>
          <td>{{ "%.1f"|format(event['total_sold']) }}</td>
          <td>{{ "%.1f"|format(event['total_leftover']) }}</td>
          <td>${{ "%.2f"|format(event['cash'] if event['cash'] else 0) }}</td>
          <td>
            <a href="{{ url_for('market_results', event_id=event['id']) }}" class="btn btn-primary"
              style="padding: 0.25rem 0.5rem; font-size: 0.75rem;">Results</a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
  <p class="text-muted">No recent market events found.</p>
  {% endif %}
</div>
{% endblock %}